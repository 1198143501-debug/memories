import{_ as z,r,c as _,h as B,l as R,b as l,d as t,n as C,e as h,f as p,g as T,a as V,t as a,w as A,m as U,v as q,F,i as I,p as E,q as P,o}from"./index-2FU-56Uf.js";import{u as j}from"./memoryStore-CEUDIOHK.js";const G={key:0,class:"detail"},H=["src","alt"],J=["src"],K={class:"info"},O={class:"meta"},Q={class:"story"},W={class:"actions"},X=["disabled"],Y={class:"comments"},Z=["disabled"],$={key:0,class:"empty-comment"},ee={key:1,class:"comment-list"},te={key:1,class:"state"},ae={key:0},se={key:1},le={__name:"Detail",setup(oe){const k=E(),D=P(),n=j(),v=r(!0),y=r(""),e=r(null),d=r(!1),c=r(""),m=r(!1),M=_(()=>e.value?.createdAt?new Date(e.value.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):""),g=_(()=>e.value?n.isLiked(e.value.id):!1),b=_(()=>e.value?.comments??[]),w=async()=>{v.value=!0,y.value="";try{n.initialized||await n.loadMemories(),e.value=n.getMemoryById(k.params.id),e.value||(y.value="æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å›žå¿†ï¼Œè¯•è¯•è¿”å›žé¦–é¡µåˆ·æ–°åˆ—è¡¨")}finally{v.value=!1}},x=async()=>{e.value&&await n.likeMemory(e.value.id)},L=async()=>{if(!e.value||m.value)return;const i=c.value.trim();if(i){m.value=!0;try{await n.addComment(e.value.id,{author:"",content:i}),c.value=""}finally{m.value=!1}}},S=i=>new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=async()=>{if(!(!e.value||d.value||!window.confirm("ç¡®å®šåˆ é™¤è¿™æ®µæ—§æ—¶å…‰å—ï¼Ÿæ“ä½œä¸å¯æ’¤é”€ã€‚"))){d.value=!0;try{await n.deleteMemory(e.value.id),D.push("/")}finally{d.value=!1}}};return B(w),R(()=>k.fullPath,()=>{w()}),(i,s)=>{const f=V("RouterLink");return!v.value&&e.value?(o(),l("section",G,[t("div",{class:C(["media",e.value.mediaType])},[e.value.mediaType==="image"?(o(),l("img",{key:0,src:e.value.mediaUrl,alt:e.value.title},null,8,H)):(o(),l("video",{key:1,src:e.value.mediaUrl,controls:"",playsinline:""},null,8,J))],2),t("div",K,[h(f,{to:"/",class:"back"},{default:p(()=>[...s[1]||(s[1]=[T("â† è¿”å›žå›žå¿†å¢™",-1)])]),_:1}),t("p",O,a(e.value.year)+" å¹´ Â· "+a(M.value),1),t("h1",null,a(e.value.title),1),t("p",Q,a(e.value.story),1),t("div",W,[t("button",{class:C({active:g.value}),onClick:x},a(g.value?"â¤ï¸ å·²å–œæ¬¢":"ðŸ¤ å–œæ¬¢")+" Â· "+a(e.value.likes),3),h(f,{to:"/timeline"},{default:p(()=>[...s[2]||(s[2]=[t("button",{class:"ghost"},"æŸ¥çœ‹æ—¶é—´è½´",-1)])]),_:1}),t("button",{class:"danger",disabled:d.value,onClick:N},a(d.value?"åˆ é™¤ä¸­...":"åˆ é™¤è¿™æ®µå›žå¿†"),9,X)]),t("section",Y,[s[3]||(s[3]=t("h2",null,"ç•™è¨€å¢™",-1)),t("form",{class:"comment-form",onSubmit:A(L,["prevent"])},[U(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=u=>c.value=u),placeholder:"åˆ†äº«ä½ æ­¤åˆ»çš„å¿ƒæƒ…æˆ–è®°å¿†ç‰‡æ®µ...",rows:"3",required:""},null,512),[[q,c.value]]),t("button",{type:"submit",disabled:m.value||!c.value.trim()},a(m.value?"å‘é€ä¸­...":"å†™ä¸‹å¿ƒå£°"),9,Z)],32),b.value.length?(o(),l("ul",ee,[(o(!0),l(F,null,I(b.value,u=>(o(),l("li",{key:u.id},[t("header",null,[t("strong",null,a(u.author||"åŒ¿å"),1),t("span",null,a(S(u.createdAt)),1)]),t("p",null,a(u.content),1)]))),128))])):(o(),l("p",$,"è¿˜æ²¡æœ‰ç•™è¨€ï¼Œå†™ä¸‹ç¬¬ä¸€å¥ç¥ç¦å§ã€‚"))])])])):(o(),l("section",te,[v.value?(o(),l("div",ae,"æ­£åœ¨æ‰“å¼€è¿™æ®µå›žå¿†...")):(o(),l("div",se,[t("p",null,a(y.value||"æ²¡æœ‰æ‰¾åˆ°è¿™æ®µè®°å¿†"),1),h(f,{to:"/upload"},{default:p(()=>[...s[4]||(s[4]=[t("button",null,"åŽ»ä¸Šä¼ æˆ‘çš„å›žå¿†",-1)])]),_:1})]))]))}}},ue=z(le,[["__scopeId","data-v-738d6894"]]);export{ue as default};
