import{_ as M,r,b as d,o as v,d as a,k as w,t as x,w as f,n as V,c as k,l as S,e as F,g as y,m as b,v as U,u as D}from"./index-2FU-56Uf.js";import{u as P}from"./memoryStore-CEUDIOHK.js";const $={class:"content"},h={key:0,class:"error"},j={key:1,class:"file-name"},B={__name:"UploadZone",emits:["select"],setup(N,{emit:p}){const i=p,o=r(!1),s=r(""),n=r(""),u=t=>{if(!t)return!1;const e=["image/jpeg","image/png","video/mp4"],l=50*1024*1024;return e.includes(t.type)?t.size>l?(s.value="文件需小于 50MB",!1):(s.value="",!0):(s.value="仅支持 JPG / PNG / MP4",!1)},c=t=>{u(t)&&(n.value=t.name,i("select",t))},g=t=>{const[e]=t.target.files;c(e),t.target.value=""},_=t=>{o.value=!1;const e=t.dataTransfer.files[0];c(e)};return(t,e)=>(v(),d("label",{class:V(["upload-zone",{dragging:o.value}]),onDragover:e[0]||(e[0]=f(l=>o.value=!0,["prevent"])),onDragleave:e[1]||(e[1]=f(l=>o.value=!1,["prevent"])),onDrop:f(_,["prevent"])},[a("input",{type:"file",accept:".jpg,.jpeg,.png,.mp4",class:"hidden-input",onChange:g},null,32),a("div",$,[e[2]||(e[2]=a("p",null,"拖拽图片 / 视频到这里，或点击选择文件",-1)),e[3]||(e[3]=a("small",null,"支持 JPG / PNG / MP4，最大 50MB",-1)),s.value?(v(),d("p",h,x(s.value),1)):w("",!0),n.value?(v(),d("p",j,"已选择："+x(n.value),1)):w("",!0)])],34))}},z=M(B,[["__scopeId","data-v-4e5e0bb4"]]),C={class:"upload"},G={class:"panel"},L=["max"],R={key:0,class:"preview"},T=["src"],q=["src"],I=["disabled"],J={__name:"Upload",setup(N){const p=P(),i=r(""),o=r(new Date().getFullYear()),s=r(""),n=r(null),u=r(""),c=k(()=>n.value?.type.startsWith("image"));S(n,(e,l)=>{l&&u.value&&(URL.revokeObjectURL(u.value),u.value=""),e&&(u.value=URL.createObjectURL(e))});const g=k(()=>i.value&&o.value&&s.value&&n.value),_=e=>{n.value=e},t=async()=>{g.value&&(await p.addMemory({file:n.value,title:i.value,year:Number(o.value),story:s.value}),i.value="",s.value="",n.value=null)};return(e,l)=>(v(),d("section",C,[a("div",G,[l[6]||(l[6]=a("h2",null,"收藏我的旧时光快乐",-1)),a("form",{onSubmit:f(t,["prevent"])},[a("label",null,[l[3]||(l[3]=y(" 标题 ",-1)),b(a("input",{"onUpdate:modelValue":l[0]||(l[0]=m=>i.value=m),placeholder:"例如：和爷爷抓萤火虫",required:""},null,512),[[U,i.value]])]),a("label",null,[l[4]||(l[4]=y(" 年份 ",-1)),b(a("input",{"onUpdate:modelValue":l[1]||(l[1]=m=>o.value=m),type:"number",min:"1950",max:new Date().getFullYear(),required:""},null,8,L),[[U,o.value]])]),a("label",null,[l[5]||(l[5]=y(" 回忆文字 ",-1)),b(a("textarea",{"onUpdate:modelValue":l[2]||(l[2]=m=>s.value=m),placeholder:"想对这段记忆说点什么...",rows:"4",required:""},null,512),[[U,s.value]])]),F(z,{onSelect:_}),u.value?(v(),d("div",R,[c.value?(v(),d("img",{key:0,src:u.value,alt:"预览"},null,8,T)):(v(),d("video",{key:1,src:u.value,controls:""},null,8,q))])):w("",!0),a("button",{type:"submit",disabled:!g.value||D(p).loading},x(D(p).loading?"正在珍藏...":"保存到本地"),9,I)],32)])]))}},Z=M(J,[["__scopeId","data-v-721146ad"]]);export{Z as default};
